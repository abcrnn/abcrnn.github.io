<!DOCTYPE html>
<html>

<head>
    <title>abcRNN</title>
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="css/abcjs-midi.css" media="all" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"> </script>
    <script src="./js/abcjs_midi_5.6.5-min.js" type="text/javascript"></script>

    <!-- Add canvas printable -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.1/dist/html2canvas.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <style>
        textarea {
            width: unset;
            height: unset;
        }
        @media print {
            h1, p, textarea, #selection, #midi, #midi-download, hr {
                display: none;
            }
            .paper {
                position: absolute;
            }
        }
        /*from example abcjs - printable*/
        html {
            box-sizing: border-box;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }

        body {
            background-color: #f1f4f4;
            margin: 0;
            font-size: 20px;
            font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
        }


        .logo-wrapper {
            width: 90px;
            height: 67px;
            display: flex;
            align-items: center;
            padding-top: 14px;
        }

        main {
            margin: 10px 5px 0 5px;
        }

        .instructions {
            list-style: none;
            padding: 0;
        }

        .svg-inline--fa {
            opacity: .8;
        }

        .instructions .svg-inline--fa {
            opacity: .6;
        }

        .input {
            margin-bottom: 30px;
        }

        .download {
            margin-top: 30px;
        }

        .download a {
            padding: 5px 20px;
            border-radius: 8px;
            color: white;
            background: #0fb4e7;
            text-decoration: none;
        }

        .download a:hover {
            text-decoration: underline;
            background-color: #0a9ecc;
        }

        .muted {
            color: #0fb4e7;
            text-decoration: none;
        }
        .muted:hover {
            text-decoration: underline;
        }

        textarea {
            width: 100%;
            font-size: 18px;
            height: 300px;
            overflow: hidden;
            border-radius: 4px;
            padding: 8px;
            font-family: "Lucida Console", Monaco, monospace;
        }

        #warnings {
            font-family: "Lucida Console", Monaco, monospace;
            border: 2px solid #f10707;
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }

        #warnings span {
            color: #f10707;
        }

        #warnings:empty {
            display: none;
        }

        .output {
            position: relative;
        }

        footer {
            padding: 1px 0;
            margin-top: 20px;
            line-height: 30px;
        }
        footer ul {
            list-style: none;
            padding: 5px;
        }

        footer a {
            color: black;
            text-decoration: none;
            background-color: #F3ECE2;
            padding: 1px 10px;
            border-radius: 3px;
            box-shadow: 2px 2px 0px #aaa;
        }
        footer a:hover {
            text-decoration: underline;
        }

        @media screen and (min-width: 361px) {
            header h1 {
                font-size: 35px;
            }
            .logo-wrapper {
                height: 74px;
            }
        }

        @media screen and (min-width: 550px) {
            main {
                margin: 10px 30px 0 30px;
            }
            header, footer {
                padding-left: 30px;
            }
            header h1 {
                font-size: 50px;
            }
            .logo-wrapper {
                height: 98px;
            }
            .instructions {
                padding-left: 20px;
            }
        }

        @media screen {
            #canvas {
                border: 2px solid #d6b88c;
                border-radius: 4px;
            }
            #canvas svg {
                background-color: #F3ECe2;
            }
        }

        @media print {
            header, footer, nav button, main section {
                display: none;
            }
            main section.output {
                display: block;
            }
        }
    </style>
</head>

<body class="blue-grey lighten-5">
    <nav class="teal">
        <div class="nav-wrapper container">
            <a href="#" data-activates="slide-out" class="button-collapse"><i class="icon ion-navicon"></i></a>
            <a href="./index" class="brand-logo">
                <i class="icon left ion-headphone hide-on-small-only"></i> abcRNN - Music Generator
            </a>
            <ul class="right hide-on-med-and-down">
                <li><a href="./index" class="waves-effect">Home</a></li>
                <li><a href="./about" class="waves-effect">About</a></li>
                <li><a href="./model-eval">Model Evaluation</a></li>
                <li>
                    <a href="https://github.com/abcrnn/abcrnn.github.io" class="waves-effect waves-light" target="_blank"><i class="icon ion-social-github left"></i>Github</a>
                </li>
            </ul>
            <ul id="slide-out" class="side-nav">
                <li><a href="./index" class="waves-effect">Home</a></li>
                <li><a href="./about" class="waves-effect">About</a></li>
                <li><a href="./model-eval">Model Evaluation</a></li>
                <li>
                    <a href="https://github.com/abcrnn/abcrnn.github.io" class="waves-effect waves-light" target="_blank"><i class="icon ion-social-github left"></i>Github</a>
                </li>
            </ul>
        </div>
    </nav>
    <section id="banner" class="center container">
        <h3>Welcome to abcRNN</h3>
        <p class="flow-text">Web app demo coming soon!</p>
        <textarea name="abc" id="abc" cols="80" rows="15">X: 1
T: Cooley's
M: 4/4
L: 1/8
R: reel
K: Emin
|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|
EBBA B2 EB|B2 AB defg|afe^c dBAF|DEFD E2:|
|:gf|eB B2 efge|eB B2 gedB|A2 FA DAFA|A2 FA defg|
eB B2 eBgB|eB B2 defg|afe^c dBAF|DEFD E2:|
        </textarea>
        <hr />
        <div id="midi"></div>
        <div id="midi-download"></div>
        <div id="warnings"></div>
        <div id="selection"></div>
    </section>
    <section class="output row center-align container">
            <button onclick="onClickPrint();"><i class="fa fa-print" aria-hidden="true"></i> Print</button>
        <div id="canvasDisplay"></div>
    </section>
    <section class="download">
        <div id="midi-download"></div>
    </section>

    <section class="row center-align container">
        <br><br>
        <h4>About</h4>
        <div class="col s12 m6 l4">
            <i class="icon ion-ios-list-outline x5"></i>
            <h5>Problem</h5>
            <p>New ideas are hard to come by. Musicians occasionally have hard to generating new music. Most musicians need inspiration before composing their own music.</p>
        </div>
        <div class="col s12 m6 l4">
        </div>
        <div class="col s12 m6 l4">
            <i class="icon ion-ios-list-outline x5"></i>
            <h5>Goal</h5>
            <p>The goal of this app is to help artists to create new music on a specific genre.</p>
        </div>
    </section>

    <footer class="page-footer teal darken-4">
        <div class="container">
            <div class="row">
                <div class="col l6 s12">
                    <h5 class="white-text">Project Description</h5>
                    <p class="grey-text text-lighten-4">Create an powerful music generation model that can be used to help artists</p>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            <div class="container">
                Â© 2019 Copyright Text
                <a class="grey-text text-lighten-4 right" href="#!">Powered by abcRNN</a>
            </div>
        </div>
    </footer>
    <script src="js/jquery.min.js"></script>
    <script src="js/materialize.min.js"></script>
    <script src="js/app.js"></script>
    <script type="text/javascript">
        function selectionCallback(abcelem) {
            var note = {};
            for (var key in abcelem) {
                if (abcelem.hasOwnProperty(key) && key !== "abselem")
                    note[key] = abcelem[key];
            }
            console.log(abcelem);
            var el = document.getElementById("selection");
            el.innerHTML = "<b>selectionCallback parameter:</b><br>" + JSON.stringify(note);
        }
        function initEditor() {
            new ABCJS.Editor("abc", { //paper_id: "paper0",
                canvas_id: "canvasDisplay",
                generate_midi: true,
                midi_id:"midi",
                midi_download_id: "midi-download",
                generate_warnings: true,
                warnings_id:"warnings",
                abcjsParams: {
                    generateDownload: true,
                    responsive: "resize",
                    clickListener: selectionCallback,
                    downloadLabel: '<i class="fa fa-external-link-alt" aria-hidden="true"></i> Download MIDI for "%T"',
                }
            });
            ABCJS.renderAbc("logo", "X:1\n%%staffwidth 90\nK:D\nAB c", { responsive: "resize" });
        }

        function onClickPrint(){

            // html2canvas($('#canvasDisplay'), {
            //     onrendered: function(canvas) {
            //         canvas.setAttribute("id", "canvas");
            //         document.body.appendChild(canvas);
            //     }
            // });//this all works, the canvas appears as expected

            // var canvasElement = $(document).find('#canvas');
            // console.log(canvasElement);

            var fileName = "songs.png";
            // var canvasElement = document.getElementById("canvasDisplay");
            // console.dir(canvasElement);
            // var imageType = "image/png";
            // var imgURL    = canvasElement.get(0).toDataURL(imageType);

            // var dlLink = document.createElement('a');
            // dlLink.download = fileName;
            // dlLink.href = imgURL;

            // dlLink.dataset.downloadurl = [imageType, dlLink.download, dlLink.href].join(':');
            // document.body.appendChild(dlLink);
            // dlLink.click();
            // document.body.removeChild(dlLink);
            const filename  = 'songs.pdf';

              // var pdf = new jsPDF('p','pt','a4');
              
              //   pdf.addHTML(document.getElementById("pdfTable"),function() {

              // });

              //   pdf.save('pdfTable.pdf');

            html2canvas(("#canvasDisplay"), 
                                    {scale: 'quality'}
                             ).then(canvas => {
                let pdf = new jsPDF('p', 'mm', 'a4');
                // pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 211, 298);
                pdf.addHTML(canvas,function() {});

                // pdf.save('pdfTable.pdf');


                pdf.save(filename);
            });

        }

          // function genPDF()
          // {
          //  html2canvas(document.querySelector('canvasDisplay'),{
          //  onrendered:function(canvas){

          //  var img=canvas.toDataURL("image/png");
          //  var doc = new jsPDF();
          //  doc.addImage(img,'JPEG',20,20);
          //  doc.save('test.pdf');
          //  }
        window.addEventListener("load", initEditor, false);
    </script>


</body>

</html>
